---
title: "analyzer_front_page"
author: "ziyi"
date: "7/28/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
data.trend <- read.delim2("~/data/AHRQ_Challenge/MortalityMinder/beta.02/data/CDC/all_cause_of_death.txt")

data.trend$Year <- data.trend$Year-1999

data.trend <- data.trend %>% 
  tidyr::drop_na(Deaths) %>%
  group_by(X2013.Urbanization.Code,Year)%>%
              summarise(death=mean(as.numeric(Deaths)),population=mean(sum(as.numeric(Population))))


```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
ggplot(data=data.trend, aes(x=Year, y=death, group=X2013.Urbanization.Code,color=X2013.Urbanization.Code))+
  geom_smooth(method = "auto",se=F)+
  ylab("percentage")+
  geom_point()+
  theme_classic()+
  ggtitle("Death of despair")
```

```{r}
index <- cdc.data$death_cause == "Despair"
data.despair <- cdc.data[index,]

data.despair <- data.despair %>% 
  tidyr::drop_na(death_rate) %>%
  group_by(period)%>%
        summarise(mean_rate=mean(death_rate))

index <- data.despair$period == "2000-2002"
data.despair$period[index] <- 0
index <- data.despair$period == "2003-2005"
data.despair$period[index] <- 1
index <- data.despair$period == "2006-2008"
data.despair$period[index] <- 2
index <- data.despair$period == "2009-2011"
data.despair$period[index] <- 3
index <- data.despair$period == "2012-2014"
data.despair$period[index] <- 4
index <- data.despair$period == "2015-2017"
data.despair$period[index] <- 5


```

```{r}
ggplot(data=data.despair, aes(x=period, y=mean_rate,group=1))+
  geom_line()+
  ylab("percentage")+
  geom_point()+
  theme_classic()+
  ggtitle("Death of despair")
```
```{r}
index <- cdc.data$death_cause == "Assault"
data.assault <- cdc.data[index,]

data.assault <- data.assault %>% 
  tidyr::drop_na(death_num) %>%
  group_by(urban_2013,period)%>%
        summarise(mean_rate=mean(death_num/sum(population)))

index <- data.assault$period == "2000-2002"
data.assault$period[index] <- 0
index <- data.assault$period == "2003-2005"
data.assault$period[index] <- 1
index <- data.assault$period == "2006-2008"
data.assault$period[index] <- 2
index <- data.assault$period == "2009-2011"
data.assault$period[index] <- 3
index <- data.assault$period == "2012-2014"
data.assault$period[index] <- 4
index <- data.assault$period == "2015-2017"
data.assault$period[index] <- 5
```

```{r}
ggplot(data=data.assault, aes(x=period, y=mean_rate, group=urban_2013,color=urban_2013))+
  geom_line()+
  ylab("percentage")+
  geom_point()+
  theme_classic()+
  ggtitle("Death by Assault")

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
